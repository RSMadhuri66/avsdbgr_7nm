# SCMB bandgap reference circuit for ASAP 7nm PDK - avsdbgr_7nm 

## Bandgap Reference Circuit characteristics table 

This document summarizes the key parameters of the bandgap reference circuit used for temperature compensation and stable output voltage generation.

## Parameters

| Parameter         | Description                              | Min   | Type       | Max   | Unit | Condition                         |
|-------------------|------------------------------------------|-------|-----------|-------|------|-----------------------------------|
| **Vref**          | Output reference voltage                 | 1.12  | 1.19756   | 1.26  | V    | T = -45Â°C to 150Â°C, VDD = 1.4V   |
| **Vctat**         | Complementary to absolute temperature     | 140   | 190       | 210   | mV   | T = -45Â°C to 150Â°C, VDD = 1.4V   |
| **Vptat**         | Proportional to absolute temperature      | 0.93  | -         | 1.11  | V    | T = -45Â°C to 150Â°C, VDD = 1.4V   |
| **VDD**           | Supply Voltage                            | -     | 1.4       | -     | V    | T = -45Â°C to 150Â°C               |
| **IDD (EN=1)**    | Supply Current                           | -     | 35.20     | -     | ÂµA   | VDD = 1.4V, T = 27Â°C             |
| **RL**            | Load Resistance                          | -     | 33.33     | -     | kÎ©   | VDD = 1.4V, T = 27Â°C             |
| **R1**            | Resistance 1                             | -     | 33        | -     | kÎ©   | VDD = 1.4V, T = 27Â°C             |
| **temp_coeff**    | Temperature Coefficient                  | 360  |    -       | 432   | ppm/Â°C| T = -45Â°C to 150Â°C, VDD = 1.4V | 

## Summary of Key Parameters

- **Output Reference Voltage (\(V_{\text{ref}}\))**: Ranges from 1.12 V to 1.26 V across a wide temperature range.
- **Complementary to Absolute Temperature (\(V_{ctat}\))**: Essential for temperature compensation.
- **Proportional to Absolute Temperature (\(V_{ptat}\))**: Ranges from 0.93 V to 1.11 V.
- **Supply Voltage (\(V_{DD}\))**: Fixed at 1.4 V.
- **Supply Current (\(IDD\))**: The current draw when enabled is **35.20 ÂµA** at 27Â°C.
- **Load Resistance (\(R_L\))**: 33.33 kÎ©, affecting output voltage under load.
- **Resistance \(R1\)**: Set at 33 kÎ© which is the resistance near PTAT circuit.
- **Temperature Coefficient** : To find out voltage stability.

## Explanation 

This project demonstrates the design and operation of a Bandgap Reference (BGR) circuit using 7nm ASAP technology. The goal of the circuit is to generate a temperature-independent reference voltage by combining the properties of Proportional to Absolute Temperature (PTAT) and Complementary to Absolute Temperature (CTAT) voltages. Such circuits are crucial in integrated circuit design for creating a stable voltage reference, regardless of temperature, process variations, or supply fluctuations.

```
Key Components:
MOSFETs (pMOS and nMOS transistors)
Resistors
Self-Biasing Current Mirrors
Startup Circuit
Main Output:
Vref: The desired temperature-independent reference voltage.
Vctat: A voltage that is complementary to the absolute temperature, used in temperature compensation.
```

### Circuit Functionality 

#### SCMB - Self Current Mirror Based Confiuration 

The circuit employs self-biasing current mirrors using matched pMOS and nMOS transistors to maintain stable currents in different branches of the circuit. Current mirrors play a vital role in balancing the PTAT and CTAT components that determine the reference voltage.

Key Current Mirror Transistors:
- pfet1, pfet2, pfet3: These pMOS transistors form a current mirror network to maintain stable biasing throughout the circuit.
- nfet1, nfet2: These nMOS transistors mirror the current in the lower portion of the circuit, which contributes to generating the CTAT voltage.

#### Startup Circuit
A startup circuit is required to ensure that the bandgap reference starts up correctly and avoids falling into a non-operational state (zero-current state). Without this circuit, the bandgap could remain in an undesired state where no current flows, rendering the reference non-functional.

Startup Transistors: The bottom part of the circuit includes additional transistors, like nfet8 and pfet6, that help kick-start the current when power is first applied, ensuring the circuit reaches its stable operating point.

#### The Schematic Diagram 

<picture>
<img alt = "Schematic" src="Xschem_bgr.png">
</picture>


#### PTAT Voltage Generation - Proportional to Absolute Temperature 

PTAT voltage is a crucial part of the temperature compensation mechanism in bandgap reference circuits. It is generated by creating a current that increases proportionally with temperature.

Resistor Network: The resistors R1 and R2 in the circuit, along with the associated transistors, are used to generate the PTAT current.
nMOS Transistors: The nfet1, nfet2 transistors create a current that depends on the temperature-dependent voltage drop across the resistors. This forms the PTAT component.

The PTAT current increases as temperature increases, helping to counteract the CTAT component and maintain a stable reference voltage.

Ngpsice command 

```
plot v(vref) -v(Vctat)

```

#### The PTAT voltage Graph 

<picture>
<img alt = "PTAT Voltage" src="Vptat_bgr.png">
</picture>


#### CTAT Voltage generation - Complementary to Absolute Temperature 

This voltage decreases with an increase in temperature, and it is crucial for creating the temperature compensation effect.

Vctat Node: The voltage at the Vctat node decreases with temperature, exhibiting CTAT behavior. This voltage is generated by the lower half of the circuit, which includes nMOS transistors and their associated current mirrors.

Ngspice command 

```
plot v(Vctat)

```

#### The CTAT Voltage Graph 

<picture>
<img alt = "CTAT Voltage" src="Vctat_bgr .png">
</picture>


#### Temperature Compensation and Voltage Reference (Vref)

The core functionality of the bandgap reference lies in summing the PTAT and CTAT voltages in a specific ratio that cancels out their temperature dependencies. This produces a stable reference voltage (Vref) at the desired node. The circuit is designed to maintain a constant output regardless of temperature variations.

Vref Node: The Vref node in the circuit provides the temperature-stable reference voltage, a sum of the PTAT and CTAT voltages. This reference voltage can be used in various applications, such as ADCs, voltage regulators, and other analog circuits.

Ngspice command 

```
plot v(Vref)

``` 

#### The Reference Voltage 

<picture>
<img alt = "BGR voltage" src="Vref_bgr.png">
</picture>


### Temperature Coefficient

The temperature coefficient (TC) of a reference voltage is a measure of how much the output voltage changes with temperature. In the context of bandgap reference (BGR) circuits, the goal is to create a voltage that remains as stable as possible across a wide temperature range. The TC tells us how sensitive the reference voltage is to temperature variations.

The temperature coefficient is expressed as the change in the reference voltage per degree Celsius (or Kelvin) relative to the nominal voltage at a specific temperature (typically room temperature).

It is usually expressed in ppm/Â°C (parts per million per degree Celsius) or mV/Â°C.

Formula 
```
TC = [(Vref(T2) - Vref(T1)) / ((T2 - T1) * Vref(T1))] * 10^6 ppm/Â°C
```
ngspice command to get temperature coefficient 

```
plot deriv(v(Vref))/1.20 - I have just taken the nominal voltage and plot it across the temp sweep. For accurate value, I have done manual claculation.

```

Where:
- V_ref(T1) is the reference voltage at temperature T1 (usually at room temperature at -45Â°C).
- V_ref(T2) is the reference voltage at temperature T2 (temperature at 150Â°C).
- (T2 - T1) is the temperature difference in Â°C.
- 10^6 converts the result to parts per million (ppm).


<picture>
<img alt = "Temp_coeff" src="temp_coeff.png">
</picture>

### Formulas to calculate the parameters 


I have calculated the parameters from the graphs that were plotted, but to get the parameters we can always refer to the formulas. 

Equations for Bandgap Reference Circuit
1. PTAT Current Calculation
The Proportional to Absolute Temperature (PTAT) current is generated by the voltage difference across two resistors 
ğ‘…
1
R 
1
â€‹
  and 
ğ‘…
2
R 
2
â€‹
 . The voltage difference is proportional to the thermal voltage 
ğ‘‰
ğ‘‡
V 
T
â€‹
 .

The PTAT current 
ğ¼
ğ‘ƒ
ğ‘‡
ğ´
ğ‘‡
I 
PTAT
â€‹
  is given by:

ğ¼
ğ‘ƒ
ğ‘‡
ğ´
ğ‘‡
=
Î”
ğ‘‰
ğ‘‡
ğ‘…
1
=
ğ‘‰
ğ‘‡
â‹…
ln
â¡
(
ğ‘
)
ğ‘…
1
I 
PTAT
â€‹
 = 
R 
1
â€‹
 
Î”V 
T
â€‹
 
â€‹
 = 
R 
1
â€‹
 
V 
T
â€‹
 â‹…ln(N)
â€‹
 
Where:

ğ‘‰
ğ‘‡
V 
T
â€‹
  is the thermal voltage 
ğ‘‰
ğ‘‡
=
ğ‘˜
ğ‘‡
ğ‘
V 
T
â€‹
 = 
q
kT
â€‹
 , where 
ğ‘˜
k is Boltzmann's constant, 
ğ‘‡
T is the absolute temperature in Kelvin, and 
ğ‘
q is the electron charge.
ğ‘
N is the emitter area ratio of the matched transistors generating the PTAT voltage.
ğ‘…
1
R 
1
â€‹
  is the resistor value used in the PTAT generation branch.
2. CTAT Voltage Calculation
The Complementary to Absolute Temperature (CTAT) voltage is generated using the base-emitter voltage 
ğ‘‰
ğµ
ğ¸
V 
BE
â€‹
  (or its MOSFET equivalent). The CTAT voltage 
ğ‘‰
ğ¶
ğ‘‡
ğ´
ğ‘‡
V 
CTAT
â€‹
  decreases with temperature:

ğ‘‰
ğ¶
ğ‘‡
ğ´
ğ‘‡
=
ğ‘‰
ğµ
ğ¸
=
ğ‘‰
ğµ
ğ¸
0
âˆ’
ğ›½
ğ‘‡
V 
CTAT
â€‹
 =V 
BE
â€‹
 =V 
BE 
0
â€‹
 
â€‹
 âˆ’Î²T
Where:

ğ‘‰
ğµ
ğ¸
0
V 
BE 
0
â€‹
 
â€‹
  is the base-emitter voltage at absolute zero temperature.
ğ›½
Î² is the temperature coefficient of 
ğ‘‰
ğµ
ğ¸
V 
BE
â€‹
 , typically around 
âˆ’
2
â€‰
mV/K
âˆ’2mV/K.
ğ‘‡
T is the temperature in Kelvin.
3. Reference Voltage Calculation (Vref)
The reference voltage 
ğ‘‰
ğ‘Ÿ
ğ‘’
ğ‘“
V 
ref
â€‹
  is obtained by combining the PTAT and CTAT voltages:

ğ‘‰
ğ‘Ÿ
ğ‘’
ğ‘“
=
ğ‘‰
ğ¶
ğ‘‡
ğ´
ğ‘‡
+
ğ‘˜
â‹…
ğ‘‰
ğ‘ƒ
ğ‘‡
ğ´
ğ‘‡
V 
ref
â€‹
 =V 
CTAT
â€‹
 +kâ‹…V 
PTAT
â€‹
 
Where 
ğ‘˜
k is a scaling factor determined by the ratio of the resistors in the circuit (typically 
ğ‘…
2
/
ğ‘…
1
R 
2
â€‹
 /R 
1
â€‹
 ):

ğ‘˜
=
ğ‘…
2
ğ‘…
1
k= 
R 
1
â€‹
 
R 
2
â€‹
 
â€‹
 
Thus, the reference voltage is a weighted sum of the CTAT and PTAT voltages, designed to be temperature independent.

4. Resistor Values
The resistor values 
ğ‘…
1
R 
1
â€‹
  and 
ğ‘…
2
R 
2
â€‹
  are critical in determining the ratio of PTAT to CTAT components:

ğ‘…
2
=
ğ‘˜
â‹…
ğ‘…
1
R 
2
â€‹
 =kâ‹…R 
1
â€‹
 
Where 
ğ‘˜
k is the desired ratio to balance the temperature coefficient of the output reference voltage.

5. Startup Circuit Currents
The startup circuit is responsible for ensuring that the bandgap reference initializes correctly. The current through the startup transistors is small and ensures the main current branches are activated.

If the startup circuit includes a small nMOS transistor, the current 
ğ¼
ğ‘ 
ğ‘¡
ğ‘
ğ‘Ÿ
ğ‘¡
ğ‘¢
ğ‘
I 
startup
â€‹
  can be calculated by:

ğ¼
ğ‘ 
ğ‘¡
ğ‘
ğ‘Ÿ
ğ‘¡
ğ‘¢
ğ‘
â‰ˆ
ğ‘‰
ğ‘”
ğ‘ 
âˆ’
ğ‘‰
ğ‘¡
â„
ğ‘…
ğ‘ 
ğ‘¡
ğ‘
ğ‘Ÿ
ğ‘¡
ğ‘¢
ğ‘
I 
startup
â€‹
 â‰ˆ 
R 
startup
â€‹
 
V 
gs
â€‹
 âˆ’V 
th
â€‹
 
â€‹
 
Where:

ğ‘‰
ğ‘”
ğ‘ 
V 
gs
â€‹
  is the gate-source voltage of the startup transistor.
ğ‘‰
ğ‘¡
â„
V 
th
â€‹
  is the threshold voltage of the nMOS transistor.
ğ‘…
ğ‘ 
ğ‘¡
ğ‘
ğ‘Ÿ
ğ‘¡
ğ‘¢
ğ‘
R 
startup
â€‹
  is the resistance in the startup circuit path.
6. Current Mirror Relationships
In current mirrors, the currents in the branches are proportional to the transistor sizing (i.e., the width-to-length ratio 
ğ‘Š
/
ğ¿
W/L):

ğ¼
ğ‘œ
ğ‘¢
ğ‘¡
=
(
ğ‘Š
ğ¿
)
ğ‘œ
ğ‘¢
ğ‘¡
â‹…
(
ğ¼
ğ‘Ÿ
ğ‘’
ğ‘“
(
ğ‘Š
ğ¿
)
ğ‘Ÿ
ğ‘’
ğ‘“
)
I 
out
â€‹
 =( 
L
W
â€‹
 ) 
out
â€‹
 â‹…( 
( 
L
W
â€‹
 ) 
ref
â€‹
 
I 
ref
â€‹
 
â€‹
 )
Where:

ğ¼
ğ‘œ
ğ‘¢
ğ‘¡
I 
out
â€‹
  is the output current of the current mirror.
ğ‘Š
/
ğ¿
W/L represents the transistor sizing ratio.
ğ¼
ğ‘Ÿ
ğ‘’
ğ‘“
I 
ref
â€‹
  is the reference current set by the current mirror.
7. Thermal Voltage (V_T)
The thermal voltage 
ğ‘‰
ğ‘‡
V 
T
â€‹
  is a key factor in PTAT calculations. It is given by:

ğ‘‰
ğ‘‡
=
ğ‘˜
ğ‘‡
ğ‘
V 
T
â€‹
 = 
q
kT
â€‹
 
Where:

ğ‘˜
k is Boltzmann's constant 
(
1.38
Ã—
1
0
âˆ’
23
â€‰
J/K
)
(1.38Ã—10 
âˆ’23
 J/K),
ğ‘‡
T is the absolute temperature in Kelvin,
ğ‘
q is the charge of an electron 
(
1.6
Ã—
1
0
âˆ’
19
â€‰
C
)
(1.6Ã—10 
âˆ’19
 C).
At room temperature 
(
ğ‘‡
=
300
â€‰
K
)
(T=300K), the thermal voltage 
ğ‘‰
ğ‘‡
â‰ˆ
26
â€‰
mV
V 
T
â€‹
 â‰ˆ26mV.

You can directly copy these equations into your README file to provide a clear mathematical description of your Bandgap Reference Circuit.





